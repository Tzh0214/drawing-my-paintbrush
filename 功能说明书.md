# 绘图系统功能说明书

## 概述

这是一个功能完整的CAD级绘图系统，支持基础图形绘制、高级曲线/曲面生成、多图层管理、撤销/重做、变换操作等功能。

---

## 第一部分：基础绘图工具

### 1. 选择工具（🖐️ 选择）

**功能说明**：

- 用于选择、移动、缩放、旋转已绘制的对象
- 支持单选和多选

**使用方法**：

1. 左侧工具栏点击"🖐️ 选择"（初始状态已选中）
2. 单击对象 → 该对象被选中（显示蓝色选框和8个缩放把手）
3. 继续按Shift+单击其他对象 → 多选
4. 拖动对象 → 移动
5. 拖动4角的把手 → 缩放
6. 拖动中间的圆形把手（旋转标记） → 旋转

**预期结果**：

- ✅ 单个对象被选中时，显示蓝色选框、8个方块缩放把手和1个旋转圆
- ✅ 多个对象被选中时，能同时移动/缩放/旋转
- ✅ 按Ctrl+A应该能全选（如未实现则标记为缺陷）
- ✅ 拖动对象时光滑移动，无卡顿
- ✅ 旋转时对象绕中心旋转，角度准确

---

### 2. 画笔工具（✏️ 画笔）

**功能说明**：

- 自由绘制线条
- 支持颜色、笔刷大小调整

**使用方法**：

1. 左侧工具栏点击"✏️ 画笔"
2. 右侧"颜色"模块选择边框颜色
3. 右侧"画笔/边框大小"滑块调整大小（1-100）
4. 在画布上拖动鼠标绘制
5. 支持光栅化模式：右侧"绘图模式"切换，可选 Bresenham/Midpoint/DDA 算法

**预期结果**：

- ✅ 画笔颜色、大小实时更新
- ✅ 绘制的线条光滑连续
- ✅ 光栅化模式下线条用指定算法绘制，与Canvas函数库效果不同
- ✅ 线条能被后续选择和编辑

---

### 3. 橡皮擦（🧽 橡皮擦）

**功能说明**：

- 删除绘制内容
- 支持两种模式：局部（只擦除笔迹）、对象（删除整个对象）

**使用方法**：

1. 左侧工具栏点击"🧽 橡皮擦"
2. 右侧"橡皮擦模式"自动上浮，选择"局部"或"对象"
3. "局部"模式：拖动擦除笔迹像素
4. "对象"模式：拖动会删除整个相交的对象

**预期结果**：

- ✅ 局部模式能精确擦除像素，不影响其他对象
- ✅ 对象模式能完整删除相交对象，无残留
- ✅ 两种模式能快速切换
- ✅ 被擦除的对象可撤销（Ctrl+Z）

---

### 4. 油漆桶（🎨 油漆桶）

**功能说明**：

- 填充闭合区域

**使用方法**：

1. 左侧工具栏点击"🎨 油漆桶"
2. 右侧"颜色"模块选择填充颜色
3. 在要填充的区域点击

**预期结果**：

- ✅ 闭合区域被填充为选定颜色
- ✅ 能填充矩形、圆形、多边形、文字等闭合形状
- ✅ 可撤销

---

### 5. 直线工具（📏 直线）

**功能说明**：

- 绘制直线段

**使用方法**：

1. 左侧工具栏点击"📏 直线"
2. 在画布点击开始点，再点击结束点
3. 支持系统函数库和光栅化两种模式

**预期结果**：

- ✅ 绘制精确直线
- ✅ 光栅化模式能看到 Bresenham/Midpoint/DDA 的不同效果
- ✅ 直线能被选择和编辑

---

### 6. 矩形工具（⬜ 矩形）

**功能说明**：

- 绘制矩形（可选边框色和填充色）

**使用方法**：

1. 左侧工具栏点击"⬜ 矩形"
2. 拖动鼠标从左上角到右下角
3. 释放鼠标完成绘制

**预期结果**：

- ✅ 绘制规则矩形
- ✅ 支持边框色和填充色独立设置
- ✅ 能被选择旋转缩放

---

### 7. 圆形工具（⚪ 圆形）

**功能说明**：

- 绘制圆形（可选边框色和填充色）

**使用方法**：

1. 左侧工具栏点击"⚪ 圆形"
2. 拖动鼠标定义圆形大小
3. 释放鼠标完成绘制

**预期结果**：

- ✅ 绘制圆形或椭圆
- ✅ 支持边框色和填充色独立设置
- ✅ 能被选择旋转缩放

---

### 8. 多边形工具（⬢ 多边形）

**功能说明**：

- 通过多次点击绘制多边形

**使用方法**：

1. 左侧工具栏点击"⬢ 多边形"
2. 在画布多次点击添加顶点
3. 点击"完成"或在起点附近点击关闭多边形
4. 右侧自动显示"撤销 (Ctrl+Z)"和"清空画布"等选项

**预期结果**：

- ✅ 能连续添加顶点，实时预览
- ✅ 能在任何位置添加顶点
- ✅ 完成后自动闭合
- ✅ 支持边框色和填充色

---

### 9. 文本工具（T 文本）

**功能说明**：

- 在画布上添加文本

**使用方法**：

1. 左侧工具栏点击"T 文本"
2. 在画布点击要放置文本的位置
3. 弹出对话框输入文本、选择字体、大小、颜色
4. 点击确认

**预期结果**：

- ✅ 文本能在指定位置显示
- ✅ 能编辑字体、大小、颜色
- ✅ 文本能被选择、移动、旋转
- ✅ 支持撤销

---

## 第二部分：高级曲线工具

### 10. Bézier 曲线（📐 Bézier曲线）

**功能说明**：

- 使用控制点绘制平滑Bézier曲线
- 支持任意度数（3个点为二次，4个点为三次，更多为高阶）

**使用方法**：

1. 左侧工具栏点击"📐 Bézier曲线"
2. 右侧"曲线/曲面选项"自动上浮至顶部
3. 在画布上连续点击添加控制点（显示为红圆）
4. 实时显示：
   - 灰色虚线：控制多边形
   - 青色曲线：实际Bézier曲线
5. 完成后点击右侧"✓ 完成曲线"

**曲线度数说明**：

- 3个控制点 = 二次Bézier（常用）
- 4个控制点 = 三次Bézier（通常最平滑）
- 5个或更多 = 高阶Bézier

**预期结果**：

- ✅ 控制点显示为红色圆点，有白色边框
- ✅ 控制多边形显示为灰色虚线，半透明
- ✅ Bézier曲线显示为青色连续光滑曲线
- ✅ 拖动红色控制点可实时调整曲线形状
- ✅ 点击空白处添加新控制点
- ✅ 完成后曲线被保存到画布，控制点消失
- ✅ 保存的曲线能被选择、变换、删除

---

### 11. B样条曲线（🌊 B样条曲线）

**功能说明**：

- 使用B样条基函数绘制光滑曲线
- 需要至少4个控制点
- 通常比Bézier更平滑，更易控制

**使用方法**：

1. 左侧工具栏点击"🌊 B样条曲线"
2. 在画布上连续点击添加控制点（至少4个）
3. 实时显示：
   - 灰色虚线：控制多边形
   - 黄色曲线：B样条曲线
4. 完成后点击右侧"✓ 完成曲线"

**预期结果**：

- ✅ 控制点显示为红色圆点
- ✅ 控制多边形显示为灰色虚线
- ✅ B样条曲线显示为黄色连续曲线
- ✅ 曲线经过多个（但不必全部）控制点
- ✅ 拖动控制点可调整曲线
- ✅ 与Bézier曲线相比，曲线更贴近控制多边形

---

## 第三部分：高级曲面工具

### 12. Bézier 曲面（🏔️ Bézier曲面）

**功能说明**：

- 使用4×4控制点网格生成参数化曲面
- 支持线框和填充两种显示模式

**使用方法**：

1. 左侧工具栏点击"🏔️ Bézier曲面"
2. 右侧"曲线/曲面选项"自动上浮至顶部
3. 会自动显示4×4的控制点网格（16个红点）
4. 拖动任意红点调整曲面形状，实时更新显示
5. 点击"切换显示模式"在两种模式间切换：
   - **线框模式**：显示青色（U方向等参线）和洋红色（V方向等参线）的网格
   - **填充模式**：显示三角网格，用灰度表示高度（Z值）
6. 完成后点击"✓ 完成曲面"

**预期结果**：

- ✅ 初始显示4×4控制点网格
- ✅ 实时预览曲面形状（初始为平面）
- ✅ 线框模式清晰显示两个方向的曲线族
- ✅ 填充模式用灰度表示Z高度，自动计算光照
- ✅ 拖动控制点流畅实时更新曲面
- ✅ 完成后曲面被保存，控制点消失
- ✅ 保存的曲面能被选择、旋转、缩放、删除

---

## 第四部分：选择与变换

### 13. 多选

**功能说明**：

- 同时选择多个对象进行批量操作

**使用方法**：

1. 选择工具激活状态下
2. 单击第一个对象（被选中）
3. **按住Ctrl**，继续点击其他对象
4. 可进行批量移动、缩放、旋转

**预期结果**：

- ✅ 被选中的多个对象显示蓝色选框
- ✅ 能同时拖动移动
- ✅ 能同时缩放（基于组中心）
- ✅ 能同时旋转

---

### 14. 全选（Ctrl+A）

**功能说明**：

- 一键选择画布上所有对象

**使用方法**：

- 按Ctrl+A

**预期结果**：

- ✅ 画布所有对象都被选中
- ✅ 显示公共的选框
- ✅ 能进行批量操作

---

### 15. 移动、缩放、旋转

**功能说明**：

- 对选中对象进行变换

**使用方法**：

- 选中对象后，选择工具激活
- **移动**：拖动对象中间区域
- **缩放**：拖动4个角或4条边的把手
- **旋转**：拖动中间的圆形旋转标记

**预期结果**：

- ✅ 移动平滑，无延迟
- ✅ 缩放比例正确，保持宽高比（按住Shift可自由缩放）
- ✅ 旋转绕对象中心进行，角度准确

---

### 16. 翻转操作

**功能说明**：

- 水平或竖直翻转选中对象

**使用方法**：

- 选中对象
- 菜单：变换 → 左右翻转 或 上下翻转
- 或快捷键：Ctrl+H（左右翻转）、Ctrl+Shift+V（上下翻转）

**预期结果**：

- ✅ 对象被正确翻转
- ✅ 支持批量翻转
- ✅ 可撤销

---

## 第五部分：剪贴板与撤销

### 17. 复制（Ctrl+C）

**功能说明**：

- 复制选中对象到剪贴板

**使用方法**：

1. 选中一个或多个对象
2. 按Ctrl+C

**预期结果**：

- ✅ 对象被复制（无可见反馈，但可以粘贴）
- ✅ 支持跨绘图系统会话复制

---

### 18. 粘贴（Ctrl+V）

**功能说明**：

- 粘贴剪贴板中的对象

**使用方法**：

1. 按Ctrl+C复制对象
2. 按Ctrl+V粘贴
3. 粘贴的对象会出现在画布中央附近

**预期结果**：

- ✅ 粘贴的对象显示在画布中央
- ✅ 粘贴后能立即拖动调整位置
- ✅ 支持多次粘贴（每次生成一个副本）

---

### 19. 撤销（Ctrl+Z）

**功能说明**：

- 撤销最后一次操作
- 保留最近50次操作历史

**使用方法**：

- 按Ctrl+Z
- 或点击右侧"撤销 (Ctrl+Z)"按钮

**预期结果**：

- ✅ 最后的操作被撤销
- ✅ 可连续多次撤销（最多50次）
- ✅ 撤销后的操作内容完整恢复

---

## 第六部分：图层系统

### 20. 图层管理

**功能说明**：

- 支持多图层分层绘制
- 初始有"背景"图层

**使用方法**：

1. 右侧"图层"Tab显示所有图层
2. 点击图层名称 → 激活该图层（高亮显示）
3. 在激活的图层上绘制或编辑

**图层操作**：

- **新建**：点击➕ 按钮
- **复制**：选中图层后点击📋 按钮
- **删除**：选中图层后点击🗑️ 按钮
- **移动**：选中图层后点击▲（上移）或▼（下移）

**预期结果**：

- ✅ 新建图层显示在列表中
- ✅ 激活图层高亮显示
- ✅ 在激活图层上绘制的内容只出现在该图层
- ✅ 删除图层后，该图层内容消失
- ✅ 上/下移改变图层堆叠顺序（上层覆盖下层）
- ✅ 可视化显示哪个图层当前激活

---

## 第七部分：视图与文件

### 21. 缩放与平移

**功能说明**：

- 调整画布显示比例
- 移动视图位置

**使用方法**：

**缩放**：

- 鼠标滚轮向上：放大（可到500%）
- 鼠标滚轮向下：缩小（可到10%）
- 下方工具条：− 按钮缩小，+ 按钮放大
- 输入框：显示当前缩放百分比
- "重置"按钮：回到100%

**平移**：

- 按住空格键，同时拖动鼠标移动视图
- 或使用滚轮缩放时自动调整中心

**预期结果**：

- ✅ 缩放流畅，无卡顿
- ✅ 显示100%-500%之间准确的缩放比例
- ✅ 平移时视图位置准确跟随
- ✅ 重置后回到100%默认视图

---

### 22. 网格显示/隐藏

**功能说明**：

- 显示辅助网格便于对齐

**使用方法**：

- 菜单：视图 → 显示网格（勾选/取消）

**预期结果**：

- ✅ 网格显示为浅灰色点阵，间隔25像素
- ✅ 网格仅为辅助显示，不影响绘制
- ✅ 能快速切换

---

### 23. 导出为图片

**功能说明**：

- 将绘制内容导出为PNG图片

**使用方法**：

1. 点击右侧"导出为图片"按钮
2. 或菜单：文件 → 导出为图片...
3. 选择保存位置和文件名
4. 点击保存

**预期结果**：

- ✅ 生成PNG格式图片
- ✅ 图片包含所有可见内容（所有图层）
- ✅ 分辨率与画布大小一致
- ✅ 导出过程无错误提示

---

### 24. 保存项目

**功能说明**：

- 保存绘图项目为JSON格式，包含所有图层、对象、状态

**使用方法**：

- 菜单：文件 → 保存项目
- 快捷键：Ctrl+S
- 首次保存会提示选择位置

**预期结果**：

- ✅ 项目被保存为.json文件
- ✅ 包含所有图层和对象数据
- ✅ 可重新打开并继续编辑

---

### 25. 打开项目

**功能说明**：

- 打开已保存的JSON项目文件

**使用方法**：

- 菜单：文件 → 打开项目
- 快捷键：Ctrl+O
- 选择.json项目文件
- 点击打开

**预期结果**：

- ✅ 项目完整加载，恢复所有图层和对象
- ✅ 编辑历史被清空（新的起点）
- ✅ 无数据丢失

---

### 26. 清空画布

**功能说明**：

- 删除画布上所有内容

**使用方法**：

- 点击右侧"清空画布"按钮

**预期结果**：

- ✅ 画布被清空
- ✅ 所有对象被删除
- ✅ 图层被重置（仅保留"背景"图层）
- ✅ 可撤销（返回清空前状态）

---

## 第八部分：UI动态响应

### 27. 工具栏响应

**功能说明**：

- 左侧工具栏自动高亮当前激活工具
- 右侧面板根据选中工具自动调整显示内容

**预期结果**：

- ✅ 选中工具时，左侧按钮高亮显示（蓝色背景）
- ✅ 选中不同工具时，右侧相关控制项自动上浮至顶部
  - 选择橡皮擦 → "橡皮擦模式"最先显示
  - 选择曲线/曲面 → "曲线/曲面选项"最先显示
  - 其他工具 → "颜色"、"笔刷大小"等显示
- ✅ 初始状态（选择工具）被高亮，"系统函数库"模式亮起

---

### 28. 绘图模式切换

**功能说明**：

- 在"系统函数库"和"光栅化算法"间切换

**使用方法**：

1. 右侧"绘图模式"模块
2. 选择"系统函数库"或"光栅化算法"

**初始状态**：

- ✅ 默认为"系统函数库"模式，该按钮亮起
- ✅ "光栅化算法选择"灰暗隐藏

**切换行为**：

- ✅ 选择"光栅化算法" → "光栅化算法选择"显示并亮起，可选 Bresenham/Midpoint/DDA
- ✅ 再选择"系统函数库" → "光栅化算法选择"隐藏变灰

---
